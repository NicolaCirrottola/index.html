btn.addEventListener('click', () => {
  let comando = '';
  if (state === 'APRI') {
    comando = 'APRI';
    state = 'FERMA';
    btn.textContent = 'FERMA';
    btn.style.backgroundColor = 'orange';
    statusDiv.textContent = 'Cancello in movimento, puoi fermarlo';
  } else if (state === 'FERMA') {
    comando = 'CHIUDI';
    state = 'CHIUDI';
    btn.textContent = 'CHIUDI';
    btn.style.backgroundColor = 'red';
    statusDiv.textContent = 'Cancello fermo. Countdown per chiusura automatica in corso';
    startCountdown();
  } else if (state === 'CHIUDI') {
    comando = 'APRI';
    clearInterval(timer);
    state = 'APRI';
    btn.textContent = 'APRI';
    btn.style.backgroundColor = 'green';
    statusDiv.textContent = '';
    bar.style.width = '0%';
  }

  // Invia il comando corretto al topic
  client.publish('cancello/apri', comando);
});
